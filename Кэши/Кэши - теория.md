
## Глоссарий
- **Cache miss** - промах кэша, запрошенный ключ не найден в кэше
- **Cache hit** - попадание в кэш, запрошенный ключ найден к кэше
- **Hit ratio** - процент попадания запросов в кэш, характеризует эффективность кэширования
- **Горячий ключ** - ключ, на который приходится большая часть запросов
- **Прогрев кэша** - процесс наполнения кэша данными
- **Инвалидация** - удаление кэшированных данных
## Назначение кэшей:
- сокращение responce time сервисов
- сокращение нагрузки на сторонние сервисы
- переиспользование ранее полученных данных
- стабилизация работы приложении при кратковременных отказах систем



## Какие данные кэшировать?

|                                        |                                           |
| -------------------------------------- | ----------------------------------------- |
| Данные часто меняются(секунды)         | нет смысла добавлять такие данные в кэш   |
| Данные меняются нечасто (минуты, часы) | возможно, стоит дабавить эти данные в кэш |
| Меняются редко (дни, недели....)       | можно спокойно кэшировать эти данные      |

Можно кэшировать ошибки. Например, можно кэшировать факт отсутствия пользователя , и далее - просто отбиваться кэшом, а не проходить всякие контроли, как для запросов с валидными данными. 

## Эффективность кэширования


Формула определения среднего времени доступа к кэшу:
```
AverageTime = DBAccessTime *  CacheMissRate + CacheAccessTime
```
Где:
DBAccessTime - время запроса  к БД
CacheMissRate - показатель  промахов кэша
CacheAccessTime - время при обращении к кэшу

Принцип - чем значение у **AverageTime**  меньше **DBAccessTime** - тем лучше

Допустим:
**DBAccessTime** = 100ms
**CacheAccessTime** = 20ms
Тогда при **CacheMissRate** > 0.8 применение кэша будет нецелесообразно. Так как в этом случае **AverageTime** > **DBAccessTime** 


## Виды кэширования
- **Внутреннее кэширование** - сюда относятся кэши, реализованных в различных структурах самих ЯП, на которых пишется приложение.
	- ### Плюсы:
		- Высокая скорость 
		- Отсутствие сетевых запросов
		- Нет расходов на сериализацию/десериализацию данных
	- ### Минусы
		- Горизонтальное масштабирование
		- Прогрев кэша после  падения сервиса
- **Внешнее кэширование** - выделение кэша в отдельный сервис 
	- ### Плюсы
		- Хранение большого объемы данных
		- Простое горизонтальное масштабирование
		- После падения сервиса кэш не теряется
		- Простой прогрев кэша и простая логика инвалидации
	- ### Минусы
		- Скорость работы

## Способы взаимодействия с кэшом
- **CACHE ASIDE** - кэширование на стороне. Приложение само координирует запросы в кэш и БД и само решает, куда в данный момент обращаться.
 ![[Pasted image 20250516153605.png]]
![[Pasted image 20250516153751.png]] 
- **CACHE THROUGH** - все запросы от приложения улетают в кэш
- ![[Pasted image 20250516155405.png]]
- ![[Pasted image 20250516161248.png]]
	- 